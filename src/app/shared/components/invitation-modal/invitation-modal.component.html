<!-- OVERLAY: Glassmorphism "White Fog" (Suave, no negro) -->
<!-- Usamos bg-black/5 para un tinte mínimo y backdrop-blur-xl para el efecto empañado fuerte -->
<div class="fixed inset-0 z-60 flex items-center justify-center p-4 
            bg-linear-to-tr from-white/20 to-white/10
            backdrop-blur-xs 
            transition-all duration-500 ease-[cubic-bezier(0.25,1,0.5,1)]" (click)="closeModal()">

    <!-- MODAL CONTAINER -->
    <div class="relative w-full max-w-[380px] bg-white/70 rounded-[28px] overflow-hidden
              shadow-[0_30px_100px_-10px_rgba(0,0,0,0.08),0_10px_30px_-5px_rgba(0,0,0,0.04)] 
              ring-1 ring-white/30
              transform transition-all duration-500
              animate-in fade-in zoom-in-95 slide-in-from-bottom-8" (click)="$event.stopPropagation()">

        <div class="relative w-full h-[150px] bg-[#080808] overflow-hidden group">

            <!-- 1. Niebla de fondo (Blobs de luz sutiles) -->
            <div class="absolute -top-12 -right-12 size-56 bg-white/5 rounded-full blur-[60px]"></div>
            <div class="absolute bottom-0 left-0 size-40 bg-white/5 rounded-full blur-[50px]"></div>

            <!-- 2. Geometría Abstracta (Lineas finas / Shards) -->
            <svg class="absolute inset-0 w-full h-full pointer-events-none opacity-30" viewBox="0 0 400 150">
                <!-- Líneas diagonales "Tech" -->
                <line x1="400" y1="0" x2="250" y2="150" stroke="white" stroke-width="0.5" />
                <line x1="420" y1="0" x2="270" y2="150" stroke="white" stroke-width="0.2" />
                <!-- Partículas -->
                <circle cx="380" cy="40" r="1" fill="white" />
                <circle cx="50" cy="100" r="1.5" fill="white" opacity="0.5" />
            </svg>

            <!-- 3. Elemento Central: Círculo Blanco + Icono Link -->
            <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-10">
                <!-- Resplandor trasero -->
                <div class="absolute inset-0 bg-white/20 blur-2xl rounded-full scale-150 animate-pulse-slow"></div>

                <!-- Círculo físico -->
                <div class="relative size-[76px] bg-white rounded-full flex items-center justify-center 
                            shadow-[0_0_40px_-10px_rgba(255,255,255,0.4)]
                            transition-transform duration-700 group-hover:scale-105">

                    <!-- Icono Link (Negro Profundo) -->
                    <svg class="size-8 text-[#0a0a0a]" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
                        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
                    </svg>
                </div>
            </div>

            <!-- 4. Botón Cerrar (Integrado) -->
            <button type="button" (click)="closeModal()" class="absolute top-4 right-4 z-20 flex justify-center items-center size-9 rounded-full 
                       bg-white/10 text-white/60 backdrop-blur-md border border-white/5
                       hover:bg-white hover:text-black hover:border-transparent hover:scale-105
                       transition-all duration-300 active:scale-95 focus:outline-none">
                <svg class="size-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M18 6 6 18" />
                    <path d="m6 6 12 12" />
                </svg>
            </button>
        </div>


        <!-- ==============================================================
             BODY: CLEAN WHITE
        ============================================================== -->
        <div class="px-7 pb-7 pt-6 bg-white">

            <!-- Título y Subtítulo -->
            <div class="text-center mb-6">
                <h3 class="text-[18px] font-black text-[#111] tracking-tight leading-tight">
                    Compartir Proyecto
                </h3>
                <p class="text-[12px] text-gray-400 font-medium mt-1.5 tracking-wide">
                    Genera un enlace temporal de acceso único.
                </p>
            </div>

            <div class="space-y-5">

                <!-- 1. Input: Selección de Rol -->
                <div class="space-y-2 text-left">
                    <label class="text-[10px] font-bold text-gray-400 uppercase tracking-widest ml-1">Nivel de
                        Permisos</label>
                    <div class="relative group">
                        <!-- Select Minimalista -->
                        <select [(ngModel)]="selectedRole" class="appearance-none block w-full py-3 px-4 
                                   bg-[#f8f8f8] hover:bg-[#f2f2f2]
                                   border border-transparent hover:border-gray-200
                                   rounded-[14px]
                                   text-[13px] font-bold text-gray-800 
                                   focus:border-black/10 focus:ring-4 focus:ring-black/5 focus:bg-white
                                   transition-all duration-300 cursor-pointer outline-none pe-10 shadow-sm">
                            @for (role of roles; track role.value) {
                            <option [value]="role.value">{{ role.label }}</option>
                            }
                        </select>
                        <!-- Flecha Custom -->
                        <div
                            class="absolute inset-y-0 right-3.5 flex items-center pointer-events-none text-gray-400 group-hover:text-black transition-colors">
                            <svg class="size-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor" stroke-width="2">
                                <path d="m6 9 6 6 6-6" />
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- 2. Sección de Resultado (Link) - Solo aparece si existe -->
                @if (generatedLink) {
                <div class="animate-in fade-in slide-in-from-top-3 duration-400 ease-out">
                    <div
                        class="p-2 bg-gray-50 rounded-[16px] border border-gray-100 shadow-[inset_0_1px_3px_rgba(0,0,0,0.03)]">
                        <div class="flex items-center gap-2">

                            <!-- Input Link -->
                            <div class="relative grow px-2">
                                <div class="flex justify-between items-center mb-0.5">
                                    <span class="text-[9px] font-bold text-gray-400 uppercase tracking-wider">Enlace
                                        generado</span>
                                    @if (isCopied) { <span
                                        class="size-1.5 bg-green-500 rounded-full animate-pulse"></span> }
                                </div>
                                <input type="text" readonly [value]="generatedLink"
                                    class="block w-full p-0 text-[12px] text-gray-600 bg-transparent border-none focus:ring-0 font-mono font-medium truncate">
                            </div>

                            <!-- Botón Copiar -->
                            <button type="button" (click)="copyLink()" class="shrink-0 flex justify-center items-center size-10 rounded-[12px] 
                                       bg-white border border-gray-200 shadow-sm text-gray-500
                                       hover:text-black hover:border-gray-300 hover:shadow-md
                                       active:scale-95 transition-all duration-300" [class.text-green-600]="isCopied"
                                [class.border-green-200]="isCopied" [class.bg-green-50]="isCopied">

                                @if (!isCopied) {
                                <svg class="size-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor" stroke-width="2">
                                    <rect width="14" height="14" x="8" y="8" rx="2" ry="2" />
                                    <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2" />
                                </svg>
                                } @else {
                                <svg class="size-5 animate-in zoom-in" xmlns="http://www.w3.org/2000/svg" fill="none"
                                    viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                                    <polyline points="20 6 9 17 4 12" />
                                </svg>
                                }
                            </button>
                        </div>
                    </div>
                    @if (isCopied) {
                    <p class="text-center text-[10px] text-green-600 font-bold mt-2 animate-in fade-in">¡Enlace copiado
                        al portapapeles!</p>
                    }
                </div>
                }

                <!-- 3. Botón Principal (Pill Shape) -->
                <button type="button" (click)="generateLink()" [disabled]="isGenerating" class="w-full relative flex justify-center items-center gap-2 px-4 py-4 rounded-[16px] 
                           bg-[#0f0f0f] text-white 
                           shadow-[0_10px_20px_-5px_rgba(0,0,0,0.3)]
                           hover:bg-black hover:shadow-[0_15px_30px_-5px_rgba(0,0,0,0.4)] hover:-translate-y-0.5 
                           active:translate-y-0 active:scale-[0.98]
                           transition-all duration-300 ease-[cubic-bezier(0.25,1,0.5,1)] group overflow-hidden
                           disabled:opacity-70 disabled:cursor-not-allowed">

                    <!-- Efecto Luz (Shine) -->
                    <div
                        class="absolute inset-0 -translate-x-full group-hover:animate-[shimmer_1.2s_infinite] bg-linear-to-r from-transparent via-white/10 to-transparent z-0">
                    </div>

                    @if (isGenerating) {
                    <span class="animate-spin block size-4 border-2 border-white/30 border-t-white rounded-full"></span>
                    }
                    @if (!isGenerating) {
                    <span class="text-[13px] font-bold tracking-wide relative z-10">
                        {{ generatedLink ? 'Generar Nuevo Enlace' : 'Generar Invitación' }}
                    </span>
                    }
                </button>

            </div>
        </div>
    </div>
</div>