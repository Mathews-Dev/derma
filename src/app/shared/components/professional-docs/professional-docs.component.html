<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4">
    @for (key of docTypes; track key) {
    <div
        class="relative group rounded-xl border border-gray-200 bg-gray-50/50 p-4 flex flex-col items-center justify-center text-center transition-all hover:bg-white hover:shadow-md h-full">

        <!-- Label -->
        <span class="text-[10px] font-bold uppercase tracking-wider text-gray-500 mb-3 min-h-[15px]">
            {{ getLabel(key) }}
        </span>

        <!-- Preview or Placeholder -->
        <div class="w-full aspect-4/3 rounded-lg bg-gray-200 mb-3 overflow-hidden flex items-center justify-center relative cursor-pointer group-viewer"
            (click)="openLightbox(documents?.[key])">
            @if (documents?.[key]) {
            <img [src]="documents?.[key]" class="w-full h-full object-cover">

            <!-- Overlay with Actions -->
            <div
                class="absolute inset-0 bg-black/40 opacity-0 group-viewer-hover:opacity-100 transition-opacity flex items-center justify-center gap-2">
                @if(!editable) {
                <span class="px-2 py-1 bg-black/70 text-white text-[10px] rounded-md backdrop-blur-sm">Ver</span>
                }
            </div>
            } @else {
            <div class="flex flex-col items-center justify-center text-gray-400">
                <svg class="w-8 h-8 opacity-50 mb-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                        d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
                </svg>
                <span class="text-[9px] uppercase tracking-wider">Pendiente</span>
            </div>
            }
        </div>

        <!-- Editable Actions -->
        @if (editable) {
        <label
            class="cursor-pointer w-full py-2 border border-gray-200 rounded-lg text-xs font-medium text-gray-600 hover:text-black hover:border-black transition-all bg-white flex items-center justify-center gap-2">
            {{ documents?.[key] ? 'Cambiar' : 'Subir' }}
            <input type="file" class="hidden" accept="image/*" (change)="onFileSelected($event, key)">
        </label>

        @if (documents?.[key]) {
        <button type="button" (click)="removeDocument(key)"
            class="absolute top-2 right-2 p-1 bg-red-50 text-red-500 rounded-full hover:bg-red-500 hover:text-white transition-colors"
            title="Eliminar">
            <svg class="w-3 h-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
        }
        } @else {
        <!-- Read Only Status text -->
        <div class="w-full text-center">
            <span class="text-[10px] uppercase font-bold tracking-widest" [class.text-emerald-600]="documents?.[key]"
                [class.text-gray-400]="!documents?.[key]">
                {{ documents?.[key] ? 'SUBIDO' : 'NO SUBIDO' }}
            </span>
        </div>
        }
    </div>
    }
</div>

<!-- ====================== LIGHTBOX ====================== -->
@if (viewingImage()) {
<div class="fixed inset-0 z-9999 bg-black/95 flex flex-col items-center justify-center animate-in fade-in duration-300">
    <!-- Close Button (Absolute Top Right) -->
    <button type="button" (click)="closeLightbox()"
        class="absolute top-6 right-6 p-2 rounded-full bg-white/10 hover:bg-white/20 text-white transition-colors hover:rotate-90 duration-300">
        <svg class="w-8 h-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12" />
        </svg>
    </button>

    <!-- Main Image -->
    <div class="w-full max-w-6xl h-[85vh] flex items-center justify-center p-4">
        <img [src]="viewingImage()" class="max-w-full max-h-full object-contain rounded-sm shadow-2xl">
    </div>

    <!-- Toolbar (Bottom) -->
    <div class="mt-4 flex gap-4">
        <button type="button" (click)="downloadImage()"
            class="flex items-center gap-2 px-8 py-3 bg-white text-black rounded-full font-bold tracking-wide hover:scale-105 active:scale-95 transition-all shadow-[0_0_20px_rgba(255,255,255,0.3)]">
            <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
            </svg>
            DESCARGAR
        </button>
    </div>
</div>
}