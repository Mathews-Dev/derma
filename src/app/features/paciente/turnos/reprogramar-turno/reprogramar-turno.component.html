<div class="w-full min-h-screen bg-white">
    <!-- Header Minimalista -->
    <div class="mx-auto pt-20 px-6 mb-12">
        <h2 class="text-4xl font-light text-black tracking-tighter">Reprogramar Turno</h2>
        <p class="text-gray-500 font-light mt-2 text-lg">Selecciona un nuevo horario para tu consulta.</p>
    </div>

    <!-- CONTENIDO -->
    <div class="mx-auto px-6 pb-20">
        @if (isLoading()) {
        <div class="flex items-center justify-center py-20">
            <div class="animate-spin rounded-full size-10 border-2 border-gray-100 border-t-black"></div>
        </div>
        } @else if (turnoActual() && profesional()) {
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-16 items-start">

            <!-- COLUMNA IZQUIERDA: CALENDARIO -->
            <div class="lg:col-span-2">
                <app-calendario-disponibilidad [profesional]="profesional()!"
                    (fechaHoraSeleccionada)="onFechaHoraSeleccionada($event)">
                </app-calendario-disponibilidad>
            </div>

            <!-- COLUMNA DERECHA: RESUMEN Y CONFIRMACIÓN -->
            <div class="space-y-12">
                <!-- Turno Actual -->
                <div>
                    <h3 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-6">Turno Actual</h3>
                    <div class="space-y-1">
                        <p class="text-2xl font-light text-gray-400 line-through decoration-gray-300">
                            {{ turnoActual()?.fecha | date:'EEEE d MMM':'':'es' }} | {{ turnoActual()?.horaInicio }} hs
                        </p>
                        <p class="text-sm text-gray-400 font-light">
                            Con {{ profesional()?.nombre }} {{ profesional()?.apellido }}
                        </p>
                    </div>
                </div>

                <!-- Nueva Selección -->
                <div class="pt-8 border-t border-gray-100">
                    <h3 class="text-xs font-bold text-black uppercase tracking-widest mb-6">Nueva Selección</h3>

                    @if (nuevaFecha() && nuevaHora()) {
                    <div class="mb-8 animate-in fade-in slide-in-from-bottom-4 duration-500">
                        <p class="text-3xl font-light text-black leading-tight">
                            {{ nuevaFecha() | date:'EEEE d MMMM':'':'es' }}
                        </p>
                        <p class="text-xl font-light text-black mt-1">
                            A las {{ nuevaHora() }} hs
                        </p>
                    </div>

                    <!-- Motivo de Reprogramación -->
                    <form [formGroup]="form" (ngSubmit)="confirmarReprogramacion()" class="space-y-6">
                        <div>
                            <label for="motivo"
                                class="block text-xs font-medium text-gray-900 mb-2 uppercase tracking-wide">
                                Motivo del cambio
                            </label>
                            <div class="relative">
                                <textarea id="motivo" formControlName="motivo" rows="3" maxlength="250"
                                    class="w-full bg-gray-50 border-0 rounded-none border-b-2 border-transparent focus:border-black focus:ring-0 transition-all text-sm resize-none p-3 placeholder:text-gray-400 font-light"
                                    placeholder="Escribe brevemente la razón..."></textarea>
                                <div class="absolute bottom-2 right-2 text-xs text-gray-400 pointer-events-none">
                                    {{ form.get('motivo')?.value?.length || 0 }} / 250
                                </div>
                            </div>
                            <p class="text-[10px] text-gray-400 mt-1 pl-1">Por favor sé breve y claro (Máx. 250
                                caracteres).</p>
                            @if (form.get('motivo')?.touched && form.get('motivo')?.invalid) {
                            <p class="text-xs text-red-500 mt-2">Requerido (min 10 caracteres).</p>
                            }
                        </div>

                        <div class="flex flex-col gap-3">
                            <button type="submit" [disabled]="form.invalid || isSubmitting()"
                                class="w-full px-6 py-4 bg-black text-white text-xs uppercase tracking-widest font-bold rounded-full hover:bg-gray-900 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-xl shadow-black/10">
                                @if (isSubmitting()) {
                                <span class="inline-block animate-spin mr-2">⟳</span>
                                }
                                Confirmar Cambio
                            </button>
                            <button type="button" (click)="cancelar()"
                                class="w-full px-6 py-3 text-gray-500 text-xs uppercase tracking-widest font-bold hover:text-black transition-colors">
                                Cancelar
                            </button>
                        </div>
                    </form>
                    } @else {
                    <div class="text-gray-400 font-light text-sm italic">
                        Selecciona un horario disponible en el calendario.
                    </div>
                    <div class="mt-8">
                        <button type="button" (click)="cancelar()"
                            class="text-gray-400 text-xs uppercase tracking-widest font-bold hover:text-black transition-colors">
                            Volver
                        </button>
                    </div>
                    }
                </div>
            </div>
        </div>
        }
    </div>
</div>